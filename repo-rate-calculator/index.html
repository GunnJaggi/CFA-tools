<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repo Rate Calculator - Gunn Jaggi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #ffffff;
            --color-text: #000000;
            --color-text-muted: #666666;
            --color-accent: #0066ff;
            --color-border: #e5e5e5;
            --color-section-bg: #fafafa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--color-border);
            z-index: 1000;
            padding: 1.5rem 0;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-text);
            text-decoration: none;
            letter-spacing: -0.02em;
        }

        .back-link {
            color: var(--color-text-muted);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            color: var(--color-accent);
            transform: translateX(-4px);
        }

        .back-link::before {
            content: '← ';
        }

        /* Hero Section */
        .hero {
            min-height: 50vh;
            display: flex;
            align-items: center;
            padding-top: 80px;
            background: var(--color-text);
            color: white;
        }

        .hero-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 6rem 3rem;
            width: 100%;
        }

        .hero h1 {
            font-size: 4rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            letter-spacing: -0.03em;
        }

        .hero p {
            font-size: 1.2rem;
            color: #999;
            max-width: 700px;
            line-height: 1.6;
        }

        /* Main Content */
        .content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 5rem 3rem;
        }

        .section {
            background: white;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 3rem;
            margin-bottom: 2.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 2rem;
            letter-spacing: -0.02em;
        }

        .about-text {
            color: var(--color-text-muted);
            line-height: 1.8;
            font-size: 1.05rem;
            max-width: 900px;
        }

        .input-group {
            margin-bottom: 2rem;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--color-text);
            font-size: 0.95rem;
        }

        .label-with-tooltip {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--color-text);
            color: white;
            font-size: 11px;
            font-weight: bold;
            cursor: help;
            position: relative;
        }

        .tooltip-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--color-text);
            color: white;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            font-weight: normal;
            width: 220px;
            white-space: normal;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        input[type="number"] {
            width: 100%;
            padding: 1rem 1.2rem;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            background: var(--color-section-bg);
            color: var(--color-text);
            transition: all 0.2s ease;
            font-weight: 500;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--color-accent);
            background: white;
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
        }

        .row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
        }

        .info-text {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            font-style: italic;
            margin-top: 0.5rem;
        }

        .reset-btn {
            width: 100%;
            padding: 1rem;
            background: var(--color-text);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
        }

        .reset-btn:hover {
            background: var(--color-accent);
            transform: translateY(-2px);
        }

        .output-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .output-card {
            background: var(--color-section-bg);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--color-border);
            transition: all 0.3s ease;
        }

        .output-card:hover {
            border-color: var(--color-accent);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }

        .output-label {
            font-size: 0.95rem;
            color: var(--color-text-muted);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .output-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--color-text);
            letter-spacing: -0.02em;
        }

        .output-subtext {
            font-size: 0.9rem;
            color: var(--color-text-muted);
            margin-top: 0.5rem;
            font-weight: 500;
        }

        .alert {
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            font-weight: 500;
            border: 2px solid;
        }

        .alert-warning {
            background: #fff3e0;
            border-color: #ff9800;
            color: #e65100;
        }

        .alert-success {
            background: #e8f5e9;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .explanation {
            background: var(--color-section-bg);
            padding: 2rem;
            border-radius: 12px;
            line-height: 1.9;
            color: var(--color-text-muted);
            border: 1px solid var(--color-border);
            font-size: 0.95rem;
        }

        hr {
            border: none;
            border-top: 1px solid var(--color-border);
            margin: 2rem 0;
        }

        /* Footer */
        footer {
            background: var(--color-text);
            color: white;
            padding: 3rem 0;
            text-align: center;
            margin-top: 5rem;
        }

        footer p {
            color: #999;
            font-size: 0.95rem;
        }

        /* Gradient animation */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .hero {
            background: linear-gradient(-45deg, #000000, #1a1a1a, #000000, #0a0a0a);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .hero h1 {
                font-size: 3rem;
            }

            .nav-container,
            .content,
            .hero-container {
                padding-left: 2rem;
                padding-right: 2rem;
            }

            .section {
                padding: 2rem;
            }
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.05rem;
            }

            .content {
                padding: 3rem 1.5rem;
            }

            .row {
                grid-template-columns: 1fr;
            }

            .output-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="https://gunnjaggi.github.io/GunnJaggi/index.html" class="logo">Gunn Jaggi</a>
            <a href="https://gunnjaggi.github.io/GunnJaggi/index.html" class="back-link">Back to Home</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-container">
            <h1>Repurchase Agreement Calculator</h1>
            <p>
                Calculate repo purchase price, haircut, repurchase amount, and variation margin 
                for repurchase agreement transactions.
            </p>
        </div>
    </section>

    <!-- Main Content -->
    <div class="content">
        <!-- About Section -->
        <div class="section">
            <h2>About</h2>
            <p class="about-text">
                A repurchase agreement (repo) is a form of short-term borrowing where securities are sold with an agreement 
                to repurchase them at a specified price on a future date. This calculator helps determine the purchase price 
                based on initial margin, calculates the haircut percentage, computes the repurchase amount including interest, 
                and evaluates variation margin requirements when collateral values change during the repo period.
            </p>
        </div>

        <!-- Initial Repo Setup -->
        <div class="section">
            <h2>Initial Repo Setup</h2>

            <div class="row">
                <div class="input-group">
                    <label class="label-with-tooltip">
                        Security Market Price
                        <span class="tooltip-icon" data-tooltip="Current market value of the security">i</span>
                    </label>
                    <input type="number" id="marketPrice" value="0" step="0.01" min="0">
                    <p class="info-text">in millions</p>
                </div>

                <div class="input-group">
                    <label class="label-with-tooltip">
                        Initial Margin (IM)
                        <span class="tooltip-icon" data-tooltip="Margin percentage applied to determine purchase price">i</span>
                    </label>
                    <input type="number" id="initialMargin" value="0" step="0.01" min="0" max="100">
                    <p class="info-text">as percentage (%)</p>
                </div>

                <div class="input-group">
                    <label class="label-with-tooltip">
                        Repo Rate
                        <span class="tooltip-icon" data-tooltip="Annual interest rate for the repo transaction">i</span>
                    </label>
                    <input type="number" id="repoRate" value="0" step="0.01" min="0" max="100">
                    <p class="info-text">annual rate (%)</p>
                </div>

                <div class="input-group">
                    <label class="label-with-tooltip">
                        Repo Duration
                        <span class="tooltip-icon" data-tooltip="Total length of the repo agreement in days">i</span>
                    </label>
                    <input type="number" id="repoDuration" value="30" step="1" min="1">
                    <p class="info-text">in days</p>
                </div>
            </div>

            <h2 style="margin-top: 2.5rem;">Initial Calculations</h2>
            <div class="output-grid">
                <div class="output-card">
                    <div class="output-label">Purchase Price</div>
                    <div class="output-value" id="purchasePrice">₹0.00</div>
                    <div class="output-subtext">million</div>
                </div>

                <div class="output-card">
                    <div class="output-label">Haircut</div>
                    <div class="output-value" id="haircut">0.00%</div>
                    <div class="output-subtext">margin of safety</div>
                </div>

                <div class="output-card">
                    <div class="output-label">Repurchase Amount</div>
                    <div class="output-value" id="repurchaseAmount">₹0.00</div>
                    <div class="output-subtext">million at maturity</div>
                </div>
            </div>
        </div>

        <!-- Variation Margin Section -->
        <div class="section">
            <h2>Variation Margin Check</h2>
            <p class="about-text" style="margin-bottom: 2rem;">
                Check if additional collateral is needed or can be withdrawn when the security value changes during the repo period.
            </p>

            <div class="row">
                <div class="input-group">
                    <label class="label-with-tooltip">
                        Days Elapsed
                        <span class="tooltip-icon" data-tooltip="Number of days passed since repo start">i</span>
                    </label>
                    <input type="number" id="daysElapsed" value="0" step="1" min="0">
                    <p class="info-text" id="daysElapsedInfo">cannot exceed repo duration</p>
                </div>

                <div class="input-group">
                    <label class="label-with-tooltip">
                        Current Collateral Value
                        <span class="tooltip-icon" data-tooltip="Current market value of the collateral">i</span>
                    </label>
                    <input type="number" id="currentCollateralValue" value="0" step="0.01" min="0">
                    <p class="info-text">in millions</p>
                </div>
            </div>

            <div class="output-grid">
                <div class="output-card">
                    <div class="output-label">Days Remaining</div>
                    <div class="output-value" id="daysRemaining">0</div>
                    <div class="output-subtext">days until maturity</div>
                </div>

                <div class="output-card">
                    <div class="output-label">Required Collateral Value</div>
                    <div class="output-value" id="requiredCollateral">₹0.00</div>
                    <div class="output-subtext">million at current date</div>
                </div>

                <div class="output-card">
                    <div class="output-label">Variation Margin</div>
                    <div class="output-value" id="variationMargin">₹0.00</div>
                    <div class="output-subtext" id="variationMarginText">status</div>
                </div>
            </div>

            <div id="variationAlert"></div>
        </div>

        <!-- Explanation Section -->
        <div class="section">
            <h2>Explanation</h2>
            <div class="explanation" id="explanation">
                Enter values to see detailed calculation breakdown
            </div>
        </div>

        <!-- Reset Button -->
        <button class="reset-btn" onclick="resetAll()">Reset All Values</button>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Gunn Jaggi. All rights reserved.</p>
    </footer>

    <script>
        function formatCurrency(value) {
            return '₹' + value.toFixed(2);
        }

        function formatPercent(value) {
            return value.toFixed(4) + '%';
        }

        function calculate() {
            // Get inputs
            const marketPrice = parseFloat(document.getElementById('marketPrice').value) || 0;
            const initialMargin = parseFloat(document.getElementById('initialMargin').value) || 0;
            const repoRate = parseFloat(document.getElementById('repoRate').value) || 0;
            let repoDuration = parseInt(document.getElementById('repoDuration').value) || 0;
            let daysElapsed = parseInt(document.getElementById('daysElapsed').value) || 0;
            const currentCollateralValue = parseFloat(document.getElementById('currentCollateralValue').value) || 0;

            // Validate days elapsed
            if (daysElapsed > repoDuration) {
                document.getElementById('daysElapsed').value = repoDuration;
                daysElapsed = repoDuration;
            }

            document.getElementById('daysElapsedInfo').textContent = `cannot exceed ${repoDuration} days`;

            // Calculate Purchase Price
            const purchasePrice = initialMargin > 0 ? marketPrice / (1 + initialMargin / 100) : 0;

            // Calculate Haircut
            const haircut = marketPrice > 0 ? ((marketPrice - purchasePrice) / marketPrice) * 100 : 0;

            // Calculate Repurchase Amount based on duration
            let repurchaseAmount;
            if (repoDuration <= 365) {
                repurchaseAmount = purchasePrice * (1 + (repoRate / 100) * (repoDuration / 365));
            } else {
                // For durations > 365 days, use annual compounding
                const years = Math.floor(repoDuration / 365);
                const remainingDays = repoDuration % 365;
                repurchaseAmount = purchasePrice * Math.pow(1 + repoRate / 100, years) * (1 + (repoRate / 100) * (remainingDays / 365));
            }

            // Calculate Days Remaining
            const daysRemaining = repoDuration - daysElapsed;

            // Calculate Required Collateral Value at current date (using 360-day basis for variation margin)
            let collateralValueAtDate;
            if (daysRemaining <= 360) {
                collateralValueAtDate = purchasePrice * (1 + (repoRate / 100) * (daysRemaining / 360));
            } else {
                const years = Math.floor(daysRemaining / 360);
                const remainingDays = daysRemaining % 360;
                collateralValueAtDate = purchasePrice * Math.pow(1 + repoRate / 100, years) * (1 + (repoRate / 100) * (remainingDays / 360));
            }
            
            const requiredCollateral = collateralValueAtDate * (1 + initialMargin / 100);

            // Calculate Variation Margin
            const variationMargin = currentCollateralValue - requiredCollateral;
            
            // Update outputs
            document.getElementById('purchasePrice').textContent = formatCurrency(purchasePrice);
            document.getElementById('haircut').textContent = formatPercent(haircut);
            document.getElementById('repurchaseAmount').textContent = formatCurrency(repurchaseAmount);
            document.getElementById('daysRemaining').textContent = daysRemaining;
            document.getElementById('requiredCollateral').textContent = formatCurrency(requiredCollateral);
            document.getElementById('variationMargin').textContent = formatCurrency(Math.abs(variationMargin));

            // Update variation margin status
            const alertDiv = document.getElementById('variationAlert');
            const variationMarginText = document.getElementById('variationMarginText');
            
            if (variationMargin < -0.01) {
                variationMarginText.textContent = 'shortfall - post collateral';
                alertDiv.innerHTML = `
                    <div class="alert alert-warning">
                        ⚠️ <strong>Margin Call:</strong> Additional collateral of ${formatCurrency(Math.abs(variationMargin))} million must be posted to maintain required margin.
                    </div>
                `;
            } else if (variationMargin > 0.01) {
                variationMarginText.textContent = 'excess - can withdraw';
                alertDiv.innerHTML = `
                    <div class="alert alert-success">
                        ✓ <strong>Excess Margin:</strong> ${formatCurrency(variationMargin)} million in excess collateral available for withdrawal.
                    </div>
                `;
            } else {
                variationMarginText.textContent = 'adequate margin';
                alertDiv.innerHTML = `
                    <div class="alert alert-success">
                        ✓ <strong>Adequate Margin:</strong> Collateral value meets required margin requirements.
                    </div>
                `;
            }

            // Update explanation
            updateExplanation(marketPrice, initialMargin, repoRate, repoDuration, purchasePrice, 
                            haircut, repurchaseAmount, daysElapsed, daysRemaining, 
                            currentCollateralValue, requiredCollateral, variationMargin, collateralValueAtDate);
        }

        function updateExplanation(marketPrice, initialMargin, repoRate, repoDuration, purchasePrice, 
                                   haircut, repurchaseAmount, daysElapsed, daysRemaining, 
                                   currentCollateralValue, requiredCollateral, variationMargin, collateralValueAtDate) {
            let text = `The security market price is ${formatCurrency(marketPrice)} million. `;
            text += `With an initial margin of ${initialMargin.toFixed(2)}%, the purchase price is calculated as: ${formatCurrency(marketPrice)} / (1 + ${initialMargin.toFixed(2)}%) = ${formatCurrency(purchasePrice)} million. `;
            
            text += `The haircut is: (${formatCurrency(marketPrice)} - ${formatCurrency(purchasePrice)}) / ${formatCurrency(marketPrice)} = ${formatPercent(haircut)}. `;
            text += `Alternatively: 1 - 1/(1 + ${initialMargin.toFixed(2)}%) = ${formatPercent(haircut)}. `;
            
            const dayBasisText = repoDuration <= 365 ? '365' : 'compounded annually with remainder';
            text += `For a ${repoDuration}-day repo at ${repoRate.toFixed(2)}% annual rate, the repurchase amount is: ${formatCurrency(purchasePrice)} × (1 + ${repoRate.toFixed(2)}% × ${repoDuration}/${dayBasisText}) = ${formatCurrency(repurchaseAmount)} million. `;
            
            if (daysElapsed > 0) {
                text += `After ${daysElapsed} days (${daysRemaining} days remaining), the present value of the repo using 360-day basis is: ${formatCurrency(purchasePrice)} × (1 + ${repoRate.toFixed(2)}% × ${daysRemaining}/360) = ${formatCurrency(collateralValueAtDate)} million. `;
                
                text += `Adding the ${initialMargin.toFixed(2)}% margin, the required collateral value is: ${formatCurrency(requiredCollateral)} million. `;
                
                text += `The current collateral value is ${formatCurrency(currentCollateralValue)} million. `;
                
                if (variationMargin < -0.01) {
                    text += `Since this is less than the required ${formatCurrency(requiredCollateral)} million, the variation margin is ${formatCurrency(Math.abs(variationMargin))} million which must be posted as additional collateral.`;
                } else if (variationMargin > 0.01) {
                    text += `Since this exceeds the required ${formatCurrency(requiredCollateral)} million, the excess collateral of ${formatCurrency(variationMargin)} million can be withdrawn.`;
                } else {
                    text += `This meets the required collateral value. The margin is adequate.`;
                }
            }

            document.getElementById('explanation').textContent = text;
        }

        function resetAll() {
            document.getElementById('marketPrice').value = 0;
            document.getElementById('initialMargin').value = 0;
            document.getElementById('repoRate').value = 0;
            document.getElementById('repoDuration').value = 30;
            document.getElementById('daysElapsed').value = 0;
            document.getElementById('currentCollateralValue').value = 0;
            calculate();
        }

        // Add event listeners
        document.querySelectorAll('input').forEach(el => {
            el.addEventListener('input', calculate);
        });

        // Navbar shadow on scroll
        window.addEventListener('scroll', () => {
            const nav = document.querySelector('nav');
            if (window.scrollY > 50) {
                nav.style.boxShadow = '0 2px 20px rgba(0, 0, 0, 0.1)';
            } else {
                nav.style.boxShadow = 'none';
            }
        });

        // Initial calculation
        calculate();
    </script>
</body>
</html>
